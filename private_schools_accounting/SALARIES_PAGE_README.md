# صفحة إدارة الرواتب

## نظرة عامة

تم إنشاء صفحة إدارة الرواتب بنجاح لتطبيق حسابات المدارس الأهلية. هذه الصفحة تتيح إدارة كاملة لرواتب المعلمين والموظفين.

## الميزات المطلوبة والمنجزة

### ✅ الميزات المكتملة:

#### 1. عرض جميع المعلمين والموظفين
- ✅ جدول شامل يعرض جميع الرواتب المدفوعة
- ✅ عرض الاسم ونوع الموظف (معلم/موظف)
- ✅ عرض الراتب المسجل والمبلغ المدفوع

#### 2. إضافة راتب جديد
- ✅ نافذة إضافة راتب مع جميع الحقول المطلوبة
- ✅ اختيار نوع الموظف (معلم أو موظف)
- ✅ اختيار الموظف/المعلم من قائمة منسدلة
- ✅ عرض الراتب المسجل كمرجع للمحاسب
- ✅ حرية تعديل المبلغ المدفوع (زيادة أو نقصان)

#### 3. إدارة فترة الراتب
- ✅ تحديد فترة الراتب (من تاريخ - إلى تاريخ)
- ✅ افتراضي 30 يوم قبل التاريخ الحالي
- ✅ إمكانية تعديل التواريخ
- ✅ حساب عدد الأيام تلقائياً

#### 4. إحصائيات دقيقة
- ✅ عدد الرواتب المدفوعة للمعلمين والموظفين
- ✅ إجمالي المبالغ المدفوعة
- ✅ إحصائيات عامة وشهرية
- ✅ فصل إحصائيات المعلمين عن الموظفين

#### 5. إضافة ملاحظات
- ✅ حقل ملاحظات اختياري عند إضافة راتب
- ✅ عرض الملاحظات في الجدول الرئيسي

#### 6. ميزات إضافية
- ✅ البحث والفلترة المتقدمة
- ✅ فلترة حسب نوع الموظف (معلم/موظف)
- ✅ فلترة حسب فترة زمنية
- ✅ واجهة مستخدم متجاوبة وسهلة الاستخدام

## هيكل قاعدة البيانات

### جدول الرواتب (salaries):
```sql
CREATE TABLE salaries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    staff_type TEXT NOT NULL CHECK (staff_type IN ('teacher', 'employee')),
    staff_id INTEGER NOT NULL,
    staff_name TEXT NOT NULL,
    base_salary DECIMAL(10,2) NOT NULL,      -- الراتب المسجل في ملف الموظف
    paid_amount DECIMAL(10,2) NOT NULL,      -- المبلغ المدفوع فعلياً
    from_date DATE NOT NULL,                 -- بداية فترة الراتب
    to_date DATE NOT NULL,                   -- نهاية فترة الراتب
    days_count INTEGER NOT NULL,             -- عدد أيام الفترة
    payment_date DATE NOT NULL,              -- تاريخ دفع الراتب
    payment_time TIME NOT NULL,              -- وقت دفع الراتب
    notes TEXT,                              -- ملاحظات
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### الفهارس المُحسنة:
- فهرس على نوع الموظف (staff_type)
- فهرس على معرف الموظف (staff_id)
- فهرس على تاريخ الدفع (payment_date)
- فهرس على تواريخ الفترة (from_date, to_date)

## الملفات المضافة:

### 1. ملفات قاعدة البيانات:
- `update_db_for_salaries.py` - سكريبت تحديث قاعدة البيانات

### 2. ملفات واجهة المستخدم:
- `ui/pages/salaries/__init__.py`
- `ui/pages/salaries/salaries_page.py` - الصفحة الرئيسية
- `ui/pages/salaries/add_salary_dialog.py` - نافذة إضافة راتب

### 3. التحديثات على الملفات الموجودة:
- `app/main_window.py` - إضافة صفحة الرواتب للقائمة الجانبية

## كيفية الاستخدام:

### 1. الوصول لصفحة الرواتب:
- افتح التطبيق
- اضغط على زر "الرواتب" في القائمة الجانبية

### 2. إضافة راتب جديد:
1. اضغط زر "إضافة راتب"
2. اختر نوع الموظف (معلم أو موظف)
3. اختر الموظف/المعلم من القائمة
4. سيظهر الراتب المسجل كمرجع
5. أدخل المبلغ المدفوع (يمكن تعديله)
6. راجع فترة الراتب (افتراضي 30 يوم)
7. عدّل التواريخ حسب الحاجة
8. أضف ملاحظات إذا لزم الأمر
9. اضغط "إضافة الراتب"

### 3. البحث والفلترة:
- استخدم مربع البحث للبحث بالاسم
- استخدم فلتر النوع (معلم/موظف/الكل)
- استخدم فلاتر التاريخ لتحديد فترة معينة
- اضغط "مسح" لإعادة تعيين الفلاتر

### 4. عرض الإحصائيات:
- الإحصائيات العامة (جانب أيمن)
- إحصائيات الشهر الحالي
- فصل بيانات المعلمين عن الموظفين

## التصميم والأنماط:

### الواجهة:
- تصميم حديث ومتجاوب
- استخدام الألوان المتناسقة مع باقي التطبيق
- أيقونات واضحة وتسميات باللغة العربية
- دعم الاتجاه من اليمين لليسار (RTL)

### التفاعل:
- رسائل تأكيد وتحذير واضحة
- التحقق من صحة البيانات
- رسائل خطأ مفيدة
- حفظ تلقائي للإعدادات

## الميزات الفنية:

### الأداء:
- استعلامات محسنة مع فهارس
- تحميل البيانات عند الحاجة
- ذاكرة تخزين مؤقت للقوائم

### الأمان:
- التحقق من صحة البيانات
- منع الحقن SQL
- تسجيل العمليات في السجلات

### قابلية الصيانة:
- كود منظم ومقسم بوضوح
- تعليقات شاملة باللغة العربية
- معالجة شاملة للأخطاء
- تسجيل مفصل للعمليات

## التطوير المستقبلي:

### إمكانيات للتطوير:
- تقارير رواتب مفصلة
- تصدير بيانات الرواتب
- إشعارات مواعيد الرواتب
- ربط مع أنظمة البنوك
- حساب الخصومات والبدلات
- تقسيط الرواتب

### التحسينات المقترحة:
- إضافة بحث متقدم
- إضافة مراجعة وموافقة الرواتب
- ربط مع نظام الحضور والانصراف
- إضافة تقارير ضريبية

## الدعم والصيانة:

تم تطوير الصفحة بمعايير عالية الجودة وتتضمن:
- معالجة شاملة للأخطاء
- تسجيل مفصل للعمليات
- رسائل خطأ واضحة
- تصميم قابل للتوسع

جميع الميزات المطلوبة تم تنفيذها بنجاح والصفحة جاهزة للاستخدام الفوري.
