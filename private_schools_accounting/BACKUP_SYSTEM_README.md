# نظام النسخ الاحتياطية - Supabase Storage

## نظرة عامة

تم إضافة نظام النسخ الاحتياطية المتقدم إلى نظام حسابات المدارس الأهلية باستخدام Supabase Storage للتخزين السحابي الآمن.

## المميزات

### ✅ إنشاء النسخ الاحتياطية
- **نسخ احتياطي سريع**: زر مباشر بجانب "لوحة التحكم" لإنشاء نسخة احتياطية فورية
- **نسخ احتياطي مجدول**: من خلال صفحة إدارة النسخ الاحتياطية
- **ضغط تلقائي**: جميع النسخ محفوظة بصيغة ZIP لتوفير المساحة
- **معلومات مفصلة**: كل نسخة تحتوي على معلومات التاريخ والوقت والحجم

### ✅ التخزين السحابي
- **Supabase Storage**: تخزين آمن ومشفر على السحابة
- **تنظيم المجلدات**: نسخ منظمة حسب السنة والشهر
- **حماية البيانات**: عدم القدرة على الوصول المباشر بدون صلاحيات

### ✅ إدارة النسخ
- **عرض شامل**: جدول يعرض جميع النسخ المتاحة
- **تحميل مباشر**: إمكانية تحميل أي نسخة احتياطية
- **حذف انتقائي**: حذف النسخ غير المرغوب بها
- **تنظيف تلقائي**: حذف النسخ الأقدم من 30 يوماً

## كيفية الاستخدام

### 1. التثبيت والإعداد

```bash
# تثبيت المكتبات المطلوبة
install_backup_libs.bat

# أو يدوياً
pip install supabase==2.3.4
pip install storage3==0.7.7
```

### 2. تشغيل التطبيق

```bash
# تشغيل مع فحص المكتبات
run_with_backup.bat

# أو التشغيل العادي
python main.py
```

### 3. إنشاء نسخة احتياطية

#### النسخ السريع:
1. اضغط على زر "نسخ احتياطي سريع" بجانب "لوحة التحكم"
2. سيتم إنشاء النسخة ورفعها تلقائياً

#### النسخ المخطط:
1. اذهب إلى "النسخ الاحتياطية" من القائمة الجانبية
2. اضغط على "إنشاء نسخة احتياطية جديدة"
3. أدخل وصفاً اختيارياً للنسخة
4. اضغط "إنشاء النسخة"

### 4. إدارة النسخ الاحتياطية

#### عرض النسخ:
- صفحة "النسخ الاحتياطية" تعرض جميع النسخ المتاحة
- معلومات مفصلة لكل نسخة (التاريخ، الحجم، الوصف)

#### تحميل نسخة:
1. اضغط على زر "تحميل" بجانب النسخة المرغوبة
2. سيفتح رابط التحميل في المتصفح
3. التحميل يبدأ تلقائياً

#### حذف نسخة:
1. اضغط على زر "حذف" بجانب النسخة
2. أكد عملية الحذف

#### تنظيف النسخ القديمة:
1. اضغط على زر "حذف النسخ القديمة"
2. سيتم حذف جميع النسخ الأقدم من 30 يوماً

## إعدادات Supabase

تم تكوين النظام للعمل مع:
- **URL**: https://tsyvpjhpogxmqcpeaowb.supabase.co
- **Bucket**: private-schools-accounting
- **المصادقة**: Public Anonymous Key

## بنية الملفات

```
core/backup/
├── __init__.py
├── backup_manager.py      # مدير النسخ الاحتياطية الرئيسي

ui/pages/backup/
├── __init__.py
├── backup_page.py         # صفحة إدارة النسخ الاحتياطية

data/backups/
├── daily/                 # النسخ اليومية المحلية
├── weekly/                # النسخ الأسبوعية المحلية
└── manual/                # النسخ اليدوية المحلية
```

## رسائل السجل

جميع عمليات النسخ الاحتياطي يتم تسجيلها في:
- `logs/app.log`: السجل العام
- `logs/auth.log`: سجل المصادقة
- `logs/database.log`: سجل قاعدة البيانات

## استكشاف الأخطاء

### خطأ في الاتصال بـ Supabase:
1. تحقق من الاتصال بالإنترنت
2. تأكد من صحة إعدادات Supabase في `config.py`

### خطأ في تثبيت المكتبات:
```bash
pip install --upgrade supabase storage3
```

### خطأ في رفع الملف:
1. تحقق من حجم قاعدة البيانات (الحد الأقصى 100MB)
2. تأكد من صلاحيات البكت

## المتطلبات التقنية

- Python 3.7+
- PyQt5
- supabase-py 2.3.4+
- storage3 0.7.7+
- اتصال بالإنترنت للرفع والتحميل

## الأمان

- جميع النسخ مشفرة أثناء النقل والتخزين
- لا يمكن الوصول للنسخ بدون مفاتيح الوصول
- النسخ المحلية محفوظة في مجلدات آمنة

## الدعم الفني

في حالة مواجهة أي مشاكل:
1. راجع ملفات السجل
2. تأكد من صحة الإعدادات
3. تحقق من الاتصال بالإنترنت
4. تواصل مع فريق الدعم مع تفاصيل الخطأ

---

تم تطوير هذا النظام لضمان الحفاظ على بيانات المدرسة بأعلى مستويات الأمان والموثوقية.
